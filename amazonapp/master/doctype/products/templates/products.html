{% extends "templates/web.html" %}

{% block page_content %}
<style>
    /* Header Styling */
    .amazon-header {
        background-color: #ff9900;
        color: white;
        padding: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .header-content {
        display: flex;
        align-items: center;
        width: 100%;
    }

    .btn-search {
        padding: 10px 15px;
        background-color: #febd69;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }

    .cart-container {
        position: absolute;
        top: 180px;
        right: 300px;
        z-index: 1000;
    }

    /* Product Details Styling */
    .product-details {
        display: flex;
        margin: 20px;
    }

    .product-images {
        flex: 1;
        margin-right: 20px;
    }

    .main-image img {
        width: 100%;
        border-radius: 8px;
    }

    /* Product Info Styling */
    .product-info {
        flex: 2;
    }

    .product-info h1 {
        font-size: 24px;
        margin: 10px 0;
    }

    .rating {
        margin: 10px 0;
    }

    .price {
        font-size: 20px;
        color: #b12704;
    }

    .btn-primary {
        background-color: #ffa41c;
        border: none;
        padding: 10px 15px;
        border-radius: 4px;
        cursor: pointer;
        margin-right: 10px;
    }

    .btn-secondary {
        background-color: #f0c14b;
        border: 1px solid #a88734;
        padding: 10px 15px;
        border-radius: 4px;
        cursor: pointer;
    }

    /* Hide fields by default */
    .electronics-field,
    .clothing-field {
        display: none;
    }
</style>

<header class="amazon-header">
    <h3>AMAZON</h3>
</header>
<div class="cart-container">
    <button onclick="go_to_cart()" class="cart-button">Cart</button>
</div>

<div class="product-details amazon-style">
    <div class="product-images">
        <div class="main-image">
            <img id="product-image" src="{{ image |e }}" alt="{{ name1 |e }}" />
        </div>
    </div>
    <div class="product-info">
        <h1 id="product-name">{{ name1 |e }}</h1>
        <div class="rating">
            <span class="stars">★★★★☆</span>
            <span class="reviews">(123 reviews)</span>
        </div>
        <p class="price" id="price"><strong>Price:</strong> ₹ {{ price |e }}</p>
        <p class="description" id="description">{{ descreption |e }}</p>
        
        <!-- Electronics Specific Fields -->
<p class="brand electronics-field"><strong>Brand:</strong> <span id="brand-electronics">Not Available</span></p>
<p class="model electronics-field"><strong>Model:</strong> <span id="model-electronics">Not Available</span></p>
<p class="colour electronics-field"><strong>Colour:</strong> <span id="colour-electronics">Not Available</span></p>
<p class="storage electronics-field"><strong>Storage:</strong> <span id="storage-electronics">Not Available</span></p>
<p class="ram electronics-field"><strong>RAM:</strong> <span id="ram-electronics">Not Available</span></p>
<p class="warranty electronics-field"><strong>Warranty:</strong> <span id="warranty-electronics">Not Available</span></p>

<!-- Clothing Specific Fields -->
<p class="brand clothing-field"><strong>Brand:</strong> <span id="brand-clothing">Not Available</span></p>
<p class="colour clothing-field"><strong>Colour:</strong> <span id="colour-clothing">Not Available</span></p>
<p class="size clothing-field"><strong>Size:</strong> <span id="size-clothing">Not Available</span></p>
<p class="material clothing-field"><strong>Material:</strong> <span id="material-clothing">Not Available</span></p>  
        <button onclick="add_to_cart('{{ name |e }}')" class="btn btn-primary">Add to Cart</button>
        <button class="btn btn-secondary">Buy Now</button>
    </div>
</div>

<script>
    // Fetch product details from the API
    function load_product_details(name) {
        frappe.call({
            method: "amazonapp.master.doctype.products.products.get_product_details",
            args: { product_name: name },
            callback: function (response) {
                console.log(response);
                if (response.message) {
                    // Populate fields with retrieved data
                    document.getElementById("product-name").innerText = response.message.name;
                    document.getElementById("price").innerText = `Price ₹ ${response.message.price}`;
                    document.getElementById("description").innerText = response.message.description;

                    // Hide all fields initially
                    document.querySelectorAll('.electronics-field, .clothing-field').forEach(function (field) {
                        field.style.display = 'none';
                    });

                    if (response.message.category === 'Electronics') {
    // Show Electronics fields
    document.querySelectorAll('.electronics-field').forEach(function (field) {
        field.style.display = 'block';
    });
    document.getElementById("brand-electronics").innerText = response.message.brand || 'Not Available';
    document.getElementById("model-electronics").innerText = response.message.model || 'Not Available';
    document.getElementById("colour-electronics").innerText = response.message.colour || 'Not Available';
    document.getElementById("storage-electronics").innerText = response.message.storage || 'Not Available';
    document.getElementById("ram-electronics").innerText = response.message.ram || 'Not Available';
    document.getElementById("warranty-electronics").innerText = response.message.warranty || 'Not Available';
} else if (response.message.category === 'Clothing') {
    // Show Clothing fields
    document.querySelectorAll('.clothing-field').forEach(function (field) {
        field.style.display = 'block';
    });
    document.getElementById("brand-clothing").innerText = response.message.brand || 'Not Available';
    document.getElementById("colour-clothing").innerText = response.message.colour || 'Not Available';
    document.getElementById("size-clothing").innerText = response.message.size || 'Not Available';
    document.getElementById("material-clothing").innerText = response.message.material || 'Not Available';
}
                } else {
                    alert("Product details not found!");
                }
            }
        });
    }

    // Function to go to the cart page
    function go_to_cart() {
        frappe.call({
            method: "amazonapp.api.cart.get_cart",
            args: {
                user: frappe.session.user
            },
            callback: function (response) {
                if (response.message) {
                    window.location.href = `/usercart`;
                } else {
                    frappe.msgprint("Your cart is empty.");
                }
            }
        });
    }

    // Function to add a product to the cart
    function add_to_cart(name) {
        fetch("http://127.0.0.1:8000/api/method/amazonapp.api.cart.add_to_cart?name=" + name)
            .then(response => response.json())
            .then(data => {
                if (data.message) {
                    alert("Product added successfully!");
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
    }

    // Call the load_product_details function on page load
    document.addEventListener('DOMContentLoaded', function () {
        load_product_details("{{ name |e }}");
    });
</script>

{% endblock %}